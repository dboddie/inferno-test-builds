name: test-builds
run-name: Build Inferno
on: [push]
jobs:
  clone-and-build-repo:
    runs-on: ubuntu-latest
    steps:
      - run: sudo dpkg --add-architecture i386
      - run: sudo apt-get update
      - run: sudo apt-get install -y libc6-dev-i386 libx11-dev:i386 libxext-dev:i386 zip
      - run: git clone -b stm32f405 https://github.com/dboddie/inferno-os.git /tmp/inferno-os
      - run: cd inferno-os
      - run: sed -ri 's|/usr\/inferno|'$PWD'|' mkconfig
      - run: sed -ri 's/SYSHOST=Plan9/SYSHOST=Linux/' mkconfig
      - run: sed -ri 's/#OBJTYPE/OBJTYPE/' mkconfig
      - run: sed -ri 's/OBJTYPE=\$/#OBJTYPE=\$/' mkconfig
      - run: ./makemk.sh
      - run: export PATH=$PWD/Linux/386/bin/:$PATH
      - run: mk nuke
      - run: mk mkdirs
      - run: mk install
      - run: cd os/thumb2
      - run: mk
      - run: cd $WORKSPACE
